<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Setup Admin Account</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    .info {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      border-left: 4px solid #2196f3;
    }
    .success {
      background: #e8f5e9;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      border-left: 4px solid #4caf50;
      display: none;
    }
    .error {
      background: #ffebee;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      border-left: 4px solid #f44336;
      display: none;
    }
    button {
      background: #2196f3;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      margin-top: 10px;
    }
    button:hover {
      background: #1976d2;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #status {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 6px;
      font-family: monospace;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” Setup Admin Account</h1>
    
    <div class="info">
      <strong>ChÃº Ã½:</strong> Tool nÃ y sáº½ kiá»ƒm tra vÃ  táº¡o quyá»n admin cho tÃ i khoáº£n Ä‘ang Ä‘Äƒng nháº­p.
    </div>
    
    <div id="successMsg" class="success"></div>
    <div id="errorMsg" class="error"></div>
    
    <button id="loginBtn">1. ÄÄƒng nháº­p Firebase</button>
    <button id="checkBtn" disabled>2. Kiá»ƒm tra quyá»n admin</button>
    <button id="createAdminBtn" disabled>3. Táº¡o quyá»n admin</button>
    
    <div id="status"></div>
  </div>

  <!-- Import Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js';
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js';
    import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js';

    // Import firebase config from your app
    // You need to replace this with your actual firebase config
    const firebaseConfig = {
      // Copy from src/firebase.ts
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    let currentUser = null;

    const loginBtn = document.getElementById('loginBtn');
    const checkBtn = document.getElementById('checkBtn');
    const createAdminBtn = document.getElementById('createAdminBtn');
    const status = document.getElementById('status');
    const successMsg = document.getElementById('successMsg');
    const errorMsg = document.getElementById('errorMsg');

    function showStatus(msg, type = 'info') {
      status.innerHTML = msg;
      if (type === 'success') {
        successMsg.innerHTML = msg;
        successMsg.style.display = 'block';
        errorMsg.style.display = 'none';
      } else if (type === 'error') {
        errorMsg.innerHTML = msg;
        errorMsg.style.display = 'block';
        successMsg.style.display = 'none';
      } else {
        successMsg.style.display = 'none';
        errorMsg.style.display = 'none';
      }
    }

    // Check auth state
    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        showStatus(`âœ… ÄÃ£ Ä‘Äƒng nháº­p: ${user.email}`);
        loginBtn.disabled = true;
        loginBtn.textContent = 'âœ“ ÄÃ£ Ä‘Äƒng nháº­p';
        checkBtn.disabled = false;
      }
    });

    // Login
    loginBtn.addEventListener('click', async () => {
      try {
        const provider = new GoogleAuthProvider();
        const result = await signInWithPopup(auth, provider);
        currentUser = result.user;
        showStatus(`âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng: ${currentUser.email}`, 'success');
        checkBtn.disabled = false;
      } catch (error) {
        showStatus(`âŒ Lá»—i Ä‘Äƒng nháº­p: ${error.message}`, 'error');
      }
    });

    // Check admin status
    checkBtn.addEventListener('click', async () => {
      if (!currentUser) {
        showStatus('âŒ Vui lÃ²ng Ä‘Äƒng nháº­p trÆ°á»›c', 'error');
        return;
      }

      try {
        showStatus('ğŸ” Äang kiá»ƒm tra...');
        
        const adminDoc = await getDoc(doc(db, 'admins', currentUser.uid));
        const userDoc = await getDoc(doc(db, 'users', currentUser.uid));

        let statusHtml = `<strong>User ID:</strong> ${currentUser.uid}<br>`;
        statusHtml += `<strong>Email:</strong> ${currentUser.email}<br><br>`;

        if (adminDoc.exists()) {
          statusHtml += 'âœ… <strong>Admin document tá»“n táº¡i!</strong><br>';
          statusHtml += `Data: ${JSON.stringify(adminDoc.data(), null, 2)}<br>`;
          showStatus(statusHtml, 'success');
          createAdminBtn.disabled = true;
          createAdminBtn.textContent = 'âœ“ ÄÃ£ cÃ³ quyá»n admin';
        } else {
          statusHtml += 'âŒ <strong>KhÃ´ng tÃ¬m tháº¥y admin document</strong><br>';
          createAdminBtn.disabled = false;
        }

        if (userDoc.exists()) {
          const userData = userDoc.data();
          statusHtml += '<br>ğŸ“„ <strong>User document:</strong><br>';
          statusHtml += `Role: ${userData.role || '(chÆ°a cÃ³)'}<br>`;
          if (userData.role === 'admin') {
            statusHtml += 'âœ… Role = admin';
          }
        } else {
          statusHtml += '<br>âŒ <strong>KhÃ´ng tÃ¬m tháº¥y user document</strong>';
        }

        showStatus(statusHtml);
      } catch (error) {
        showStatus(`âŒ Lá»—i kiá»ƒm tra: ${error.message}`, 'error');
        console.error(error);
      }
    });

    // Create admin
    createAdminBtn.addEventListener('click', async () => {
      if (!currentUser) {
        showStatus('âŒ Vui lÃ²ng Ä‘Äƒng nháº­p trÆ°á»›c', 'error');
        return;
      }

      if (!confirm('Táº¡o quyá»n admin cho tÃ i khoáº£n nÃ y?')) {
        return;
      }

      try {
        showStatus('â³ Äang táº¡o admin document...');

        // Create admin document
        await setDoc(doc(db, 'admins', currentUser.uid), {
          email: currentUser.email,
          displayName: currentUser.displayName || '',
          photoURL: currentUser.photoURL || '',
          createdAt: serverTimestamp(),
          role: 'admin'
        });

        // Also update users document with admin role
        await setDoc(doc(db, 'users', currentUser.uid), {
          email: currentUser.email,
          displayName: currentUser.displayName || '',
          photoURL: currentUser.photoURL || '',
          role: 'admin',
          updatedAt: serverTimestamp()
        }, { merge: true });

        showStatus(`âœ… ÄÃ£ táº¡o quyá»n admin thÃ nh cÃ´ng!<br><br>
          <strong>BÆ°á»›c tiáº¿p theo:</strong><br>
          1. Deploy firestore rules: <code>firebase deploy --only firestore:rules</code><br>
          2. Refresh láº¡i trang web vÃ  thá»­ nháº­p hÃ ng`, 'success');
        
        createAdminBtn.disabled = true;
        createAdminBtn.textContent = 'âœ“ ÄÃ£ táº¡o admin';
      } catch (error) {
        showStatus(`âŒ Lá»—i táº¡o admin: ${error.message}<br><br>
          Náº¿u lá»—i permission, báº¡n cáº§n:<br>
          1. VÃ o Firebase Console > Firestore Database<br>
          2. Táº¡o collection 'admins' thá»§ cÃ´ng<br>
          3. ThÃªm document vá»›i ID = UID cá»§a báº¡n<br>
          4. Sau Ä‘Ã³ cháº¡y láº¡i script nÃ y`, 'error');
        console.error(error);
      }
    });
  </script>
</body>
</html>
