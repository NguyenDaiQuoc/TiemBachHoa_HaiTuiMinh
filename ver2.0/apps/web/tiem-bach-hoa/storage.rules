rules_version = '2';

// Craft rules based on data in your Firestore database
// allow write: if firestore.get(
//    /databases/(default)/documents/users/$(request.auth.uid)).data.isAdmin;
 rules_version = '2';

 // Storage rules with role checks (reads are public; writes restricted by role)
service firebase.storage {
  match /b/{bucket}/o {

    // Simpler, safe rules: require user to be authenticated for writes.
    // Role-based checks (via Firestore get()) are NOT supported reliably
    // inside storage.rules in all projects, and can lead to denies.

    // Public read for all files (adjust if you need private media)
    match /{allPaths=**} {
      allow read: if true;
    }

    // Inventory images: require an authenticated user to upload.
    match /inventory_images/{allPaths=**} {
      allow write: if request.auth != null;
      allow read: if true;
    }

    // Product images: require authenticated user (admin UI should ensure only admins upload)
    match /product_images/{allPaths=**} {
      allow write: if request.auth != null;
      allow read: if true;
    }

    // Category icons
    match /category_icons/{iconFile} {
      allow write: if request.auth != null;
      allow read: if true;
    }

    // Blog images
    match /blog_images/{allPaths=**} {
      allow write: if request.auth != null;
      allow read: if true;
    }

    // Other uploads: authenticated users
    match /uploads/{allPaths=**} {
      allow write: if request.auth != null;
      allow read: if true;
    }

    // User-scoped uploads: user may read/write their own files
    match /users/{userId}/{allPaths=**} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
